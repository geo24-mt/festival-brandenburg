<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
		<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Montserrat:wght@400;600;700&display=swap"rel="stylesheet">
		<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
		<link rel="stylesheet" href="css/kalender.css">
        <style>
        /* 1. BASIS & HINTERGRUND */
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.8)),
                url('Symbole/background.png') center/cover fixed no-repeat;
    overflow: hidden;
}

#map {
    width: 100%;
    height: 100%; 
    border: 1px solid gray;
    box-sizing: border-box; 
}

#Überschrift {
    box-sizing: border-box;
    height: 110px;
    width: 100%;
    background: linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71);
    background-size: 500% 500%;
    animation: holi-flow 12s ease infinite;
    border: 10px double gray;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 18px;
}

@keyframes holi-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

#Überschrift h1 {
    text-align: center;
    color: white;
    font-size: 2.8em;
    transform: rotate(-1.5deg);
    font-family: 'Bangers', system-ui;
    line-height: 1.2;
    letter-spacing: 2.5px;
    text-shadow: 3px 3px 0px #000, -1px -1px 0px #1f0, 0px 0px 10px #92f;
}

/* 3. ZENTRALER CONTAINER (Wichtig für die Positionierung der Boxen) */
.zentrum {
    position: relative;
    width: 60%;          
    min-width: 350px;    
    margin: 0 auto;     
    height: calc(100vh - 150px);
}

/* 4. DIE BOXEN (Design & Positionierung) */
/* Gemeinsames Design */
.legende, .filter, .impressum {
    background: linear-gradient(rgba(30, 30, 30, 1), rgba(30, 30, 30, 0.9)) padding-box, 
                linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) border-box;
    border: 3px solid transparent; 
    color: #fff;
    font-family: 'Montserrat', sans-serif;
    box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
    position: absolute !important;
    z-index: 2000;
    padding: 3px;
    border-radius: 12px; 
    box-sizing: border-box;
    width: 220px;
	font-size: 17px;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Links: Legende & Impressum */
.legende {
    right: calc(100% + 30px); 
    left: auto !important;
    top: 50%;
    transform: translateY(-50%); 
    padding: 15px 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
	font-weight: 600;
}


.impressum {
    right: calc(100% + 30px); 
    left: auto !important;
    top: 88%;
}

/* Rechts: Filter */
.filter {
    left: calc(100% + 30px); 
    right: auto !important;
}

/* 5. FILTER-ELEMENTE INNEN */
#landkreis, #kategorie, .slider-container, #reset-button, #impressum-button {
    background: linear-gradient(rgba(30, 30, 30, 1), rgba(30, 30, 30, 0.9)) padding-box, 
                linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) border-box;
    color: white;
    border: none;
    border-radius: 9px;
    width: 100%;
    cursor: pointer;
    font-family: 'Montserrat', sans-serif;
    height: 45px;
	text-align: center;
	box-sizing: border-box;
	display: flex;
	justify-content: center;
	align-items: center;
	font-weight: 600;
}

#reset-button:hover, #impressum-button:hover {
    color: #f8f4ff !important;
	text-shadow: 0 0 2px rgba(180, 120, 255, 0.6), 
     0 0 6px rgba(180, 120, 255, 0.4);
}
.slider-container {
	padding: 5px;
	display: flex;
	flex-direction: column;
	justify-content: center;
	height: auto; 
	box-sizing: border-box;
	overflow: hidden; 
	}
		
#preis-slider {
	background: linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) !important;
	border-radius: 5px;
	outline: none;
	-webkit-appearance: none;
	width: 100%;
	height: 7px;
	cursor: pointer;
	margin-top: 8px;
	margin-bottom: 5px;
	}
#preis-slider::-moz-range-thumb {
	background: rgba(210,210,210,1);
	height: 14px;
	width: 14px;
	}

/* 6. DROPDOWN-LISTEN */
#checkbox-list, #kat-checkbox-list {
    display: none; 
    position: absolute; 
    top: 100%; left: 0;
    background-color: rgba(30, 30, 30,0.9);
    width: 100%;
    z-index: 10000; 
    max-height: 200px;
    overflow-y: auto;
    border: 2px solid #444;
    border-radius: 9px;
	text-align: center;
}

.item {
    display: flex; align-items: center; padding: 10px; font-size: 13px; color: white;
}

/* 7. LEGENDE ICONS */
.legende-item {
    display: flex;
    align-items: center; 
    gap: 15px; 
    margin-bottom: 12px;
    width: 100%; 
}
.legende-icon-container {
    width: 48px;
    display: flex;
    justify-content: center;
    flex-shrink: 0; 
}
.legende-item img {
    width: 44px;
    height: 44px;
    object-fit: contain;
}
#landkreis, #kategorie {
    -webkit-appearance: none; /* Entfernt Browser-Standard-Styles (Chrome/Safari) */
    -moz-appearance: none;    /* Entfernt Browser-Standard-Styles (Firefox) */
    appearance: none;
    background-image: none !important; /* Entfernt eventuelle Pfeil-Grafiken */
    background-color: transparent !important; 
    border: none !important;
    outline: none !important;
}

/* 9. TOOLTIPS & POPUPS */
.my-tooltip, .landkreis-tooltip {
    background: 
	    linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.9)) padding-box, 
	    linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) border-box;
	border: 3px solid transparent; 
	color: #ffffff;
	font-family: 'Montserrat', sans-serif;
	box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
	margin-top: -10px;
}
.leaflet-popup-content {
	font-family: 'Montserrat', sans-serif;
	font-size: 13px;
	line-height: 1.4;
}	
.leaflet-popup-content th {
	font-weight: 700; 
	text-transform: uppercase; 
	letter-spacing: 0.5px;
	color: #444;
	padding-right: 40px; 
	white-space: nowrap;
	text-align: left;
}
.leaflet-popup-content-wrapper {
	background-color: rgba(255, 255, 255, 0.95); 
	border: 4px solid transparent; 
	border-radius: 15px;
	background-image: linear-gradient(rgba(255, 255, 255, 0.98), rgba(245, 245, 245, 0.98)), 
					  linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71);
	background-origin: border-box;
	background-clip: padding-box, border-box;
	box-shadow: 0 10px 25px rgba(0,0,0,0.2);
	padding: 2px;
}
.hide-tooltips .landkreis-tooltip { 
	display: none !important; 
}
/* 10. Routing-Symbol */
.leaflet-control-container .leaflet-routing-container.leaflet-bar a,
.leaflet-control-container .leaflet-routing-container a {
    background: transparent !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}
.leaflet-routing-container.leaflet-bar {
    background: 
        linear-gradient(#eee, #eee) padding-box, 
        linear-gradient(45deg, #f39c12, #e74c3c, #9b59b6, #3498db, #2ecc71) border-box !important;
    border: 3px solid transparent !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3) !important;
    min-width: 36px !important;
    min-height: 36px !important;
    transform-origin: top right !important; 
    overflow: visible !important;
}
.leaflet-routing-container.leaflet-bar:hover {
    cursor: pointer !important;
}			
/* 11. Responsive Optimierung fürs Handy */

@media (max-width: 768px) {

html, body {
    height: auto !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
	justify-content: flex-start !important; 
	gap: 0 !important;
}
#Überschrift {
    order: -1 !important;
    width: 100% !important;
    height: auto !important;     
    min-height: 80px !important; 
    padding: 5px 0 !important;
    position: relative !important;
    overflow: visible !important; 
}
#Überschrift h1 {
    font-size: 1.8em !important;  
    white-space: normal !important; 
    word-wrap: break-word !important;
    text-align: center !important;
}
.zentrum {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    height: auto !important; 
    width: 100% !important;
    order: 1 !important; 
	margin-top: 0 !important;
	padding-top: 0 !important;
}
#map {
    height: 400px !important;
    width: 90% !important;
    order: 2 !important; 
    position: relative !important;
}
.filter, .legende, .impressum {
    position: relative !important;
    left: auto !important;
    right: auto !important;
    top: auto !important;
    margin: 10px auto !important;
    width: 90% !important;
    transform: none !important;
	max-width: none !important; 
    min-width: 0 !important;  
}
.legende {
    order: 0 !important; 
    position: relative !important;
    width: 90% !important;
    margin: 15px !important;
    padding: 10px 5px !important;
    display: flex !important;
    flex-direction: row !important; 
    flex-wrap: wrap !important;   
    justify-content: center !important;
    gap: 15px !important; 
}
.legende-item {
    display: flex !important;
    flex-direction: row !important; 
    align-items: center !important;
    font-size: 13px !important;
    gap: 5px !important;
	width: auto !important;
}
.filter:has(#landkreis) { order: 3 !important; }
.filter:has(#kategorie) { order: 4 !important; }
.filter:has(.slider-container) { order: 5 !important; }
.filter:has(#calendar-container) { order: 6 !important; }
.filter:has(#reset-button) { order: 7 !important; }
.impressum { order: 8 !important; } 

#Überschrift, #Überschrift h1 {
    margin-bottom: 0 !important;
    margin-top: 0 !important;
}
.filter:has(#calendar-container) {
        position: relative !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 10px 0 !important;
        min-height: 280px !important;
    }

    /* Linkes Ornament */
    .filter:has(#calendar-container)::before {
        content: "" !important;
        position: absolute;
        left: -10px;
        top: 10%;
        bottom: 10%;
        width: 85px; /* Breite an dein Bild anpassen */
        background-image: url('Symbole/ornament.png') !important;
        background-repeat: no-repeat !important;
        background-size: contain !important;
        background-position: center !important;
        pointer-events: none;
    }

    /* Rechtes Ornament (gespiegelt) */
    .filter:has(#calendar-container)::after {
        content: "" !important;
        position: absolute;
        right: -10px;
        top: 10%;
        bottom: 10%;
        width: 85px; 
        background-image: url('Symbole/ornament.png') !important;
        background-repeat: no-repeat !important;
        background-size: contain !important;
        background-position: center !important;
        transform: scaleX(-1); /* Das Bild wird horizontal gespiegelt */
        pointer-events: none;
    }

    #calendar-container {
        position: relative;
        z-index: 2; /* Kalender liegt ÜBER den Ornamenten */
		margin:5px;
    }

    
}
        </style>
        <title>Festival-Karte Brandenburg</title>
    </head>
    <body>
      <div id="Überschrift">
			<h1>Die Bunte Welt der Festivals</h1>
		</div>
<div class="zentrum">
    <div class="filter" style="top: 0%; z-index: 10000;"> 
        <div id="landkreis">
            <div class="select-box-header" onclick="toggleCheckboxes()">
                <span>- Landkreis wählen -</span>
            </div>
            <div id="checkbox-list">
                <input type="checkbox" id="kreise" style="display: none;" checked>
                <div style="padding: 10px; display: flex; justify-content: center; gap: 15px; font-size: 13px; border-bottom: 1px solid #444; font-weight: bold;">
                    <span onclick="setAll(true)" style="cursor: pointer; color: #3498db;">Alle an</span>
                    <span onclick="setAll(false)" style="cursor: pointer; color: #e74c3c;">Alle aus</span>
                </div>

                <label class="item"><input type="checkbox" class="kreis-check" value="Barnim" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Barnim</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Brandenburg an der Havel" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Brandenburg a.d.H.</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Cottbus" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Cottbus</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Dahme-Spreewald" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Dahme-Spreewald</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Elbe-Elster" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Elbe-Elster</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Frankfurt (Oder)" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Frankfurt (Oder)</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Havelland" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Havelland</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Märkisch-Oderland" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Märkisch-Oderland</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Oberhavel" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Oberhavel</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Oberspreewald-Lausitz" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Oberspreewald-Lausitz</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Oder-Spree" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Oder-Spree</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Ostprignitz-Ruppin" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Ostprignitz-Ruppin</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Potsdam" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Potsdam</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Potsdam-Mittelmark" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Potsdam-Mittelmark</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Prignitz" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Prignitz</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Spree-Neiße" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Spree-Neiße</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Teltow-Fläming" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Teltow-Fläming</label>
                <label class="item"><input type="checkbox" class="kreis-check" value="Uckermark" onchange="updateAllCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Uckermark</label>
            </div>
        </div>
    </div>
	<div class="filter" style="top: 13%; z-index: 9000;">
        <div id="kategorie">
            <div class="select-box-header" onclick="toggleKatCheckboxes()">
                <span>- Kategorie wählen -</span>
            </div>
            <div id="kat-checkbox-list" style="display: none;">
                <input type="checkbox" id="all-kategorien" style="display: none;" checked>
                <div style="padding: 10px; display: flex; justify-content: center; gap: 15px; font-size: 13px; border-bottom: 1px solid #444; font-weight: bold;">
                    <span onclick="setAllKat(true)" style="cursor: pointer; color: #3498db;">Alle an</span>
                    <span onclick="setAllKat(false)" style="cursor: pointer; color: #e74c3c;">Alle aus</span>
                </div>
                <label class="item"><input type="checkbox" class="kat-check" value="Electro" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Electro</label>
                <label class="item"><input type="checkbox" class="kat-check" value="Fantasy / Pop" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Fantasy/Pop</label>
                <label class="item"><input type="checkbox" class="kat-check" value="Rock" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Rock</label>
                <label class="item"><input type="checkbox" class="kat-check" value="Indie / Electro" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Indie/Electro</label>
				<label class="item"><input type="checkbox" class="kat-check" value="Metal" onchange="updateAllKatCheckbox(); filterKarte(); zentriereAufAuswahl()" checked> Metal</label>
            </div>
        </div>
    </div>

    <div class="filter" style="top: 26%;">
        <div class="slider-container">
            <label for="preis-slider">- Max. Preis: <span id="preis-wert">300</span> € -</label>
            <input type="range" id="preis-slider" min="0" max="300" step="10" value="300" oninput="filterKarte()">
        </div>
    </div>

    <div class="filter" style="top: 40%;">
        <div id="calendar-container">
            <div id="calendar-header">
                <button onclick="changeMonth(-1)">◀</button>
                <h2 id="month-display"></h2>
                <button onclick="changeMonth(1)">▶</button>
            </div>
            <div id="calendar-grid">
            </div>
        </div>
    </div>

    <div class="filter" style="top: 86%;">
        <button id="reset-button" onclick="resetFilter()">Filter zurücksetzen</button>
    </div>

    <div class="legende" style="top: 40%;">
        <div class="legende-item"><img src="Symbole/Electro_symbol.png">Electro</div>
        <div class="legende-item"><img src="Symbole/Fantasy-Pop_symbol.png">Fantasy/Pop</div>
        <div class="legende-item"><img src="Symbole/Rock_symbol.png">Rock</div>
        <div class="legende-item"><img src="Symbole/Indie-Electro_symbol.png">Indie/Electro</div>
		<div class="legende-item"><img src="Symbole/Metal_symbol.png">Metal</div>
    </div>

    <div class="impressum" style="top: 80%;">
        <a href="extras/impressum.html" target="_blank" style="text-decoration: none;">
                <button id="impressum-button">
    				Impressum
				</button>
            </a>
    </div>
			<div id="map">
			</div>
		</div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="data/landkreis_1.js"></script>
        <script src="data/festival_2.js"></script>
		<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
		<script src="extras/festival-daten.js"></script>
		<script src="js/superfilter.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;
            highlightLayer.openPopup();
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:3
        }).fitBounds([[50.785984630296504,8.822093904665039],[53.75260644426723,20.05844261287134]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
		
		/****************/
		
		var routingAktiv = false;
		var control = L.Routing.control({
			waypoints: [],
			lineOptions: {
				styles: [{color: '#e74c3c', opacity: 0.8, weight: 6}] 
			},
			language: 'de',
			show: false, 
			routeWhileDragging: true,
			collapsible: true,
			geocoder: L.Control.Geocoder ? L.Control.Geocoder.photon() : null
		}).addTo(map);
		var routingContainer = control.getContainer();
		L.DomEvent.on(routingContainer, 'click', function(e) {
			L.DomEvent.stopPropagation(e);
			L.DomEvent.preventDefault(e);
			routingAktiv = !routingAktiv; 
			if (!routingAktiv) {
				control.setWaypoints([]); 
			}
		});
		map.on('click', function(e) {
			if (!routingAktiv) return; 
			var newWaypoint = e.latlng;
			var existingWaypoints = control.getWaypoints();
			if (!existingWaypoints[0] || !existingWaypoints[0].latLng) {
				control.spliceWaypoints(0, 1, newWaypoint);
			} else {
				control.spliceWaypoints(1, 1, newWaypoint);
			}
		});
		var container = control.getContainer();
		L.DomEvent.disableScrollPropagation(container);
		L.DomEvent.disableClickPropagation(container);
		/****************/
		
        var bounds_group = new L.featureGroup([]);

        map.createPane('pane_GoogleMaps_0');
        map.getPane('pane_GoogleMaps_0').style.zIndex = 400;
        var layer_GoogleMaps_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleMaps_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 3,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 22
        });
        layer_GoogleMaps_0;
        map.addLayer(layer_GoogleMaps_0);
		
		
        function pop_landkreis_1(feature, layer) {
    if (feature.properties['gen'] !== null) {
        layer.bindTooltip(String(feature.properties['gen']), {
            sticky: true,
            className: 'landkreis-tooltip', // Hier greift dein CSS!
            direction: 'auto',
            offset: [15, 10]
        });
    }
    layer.on('add', function (e) {
        e.target.getElement().style.cursor = 'default';
    });
}
        function style_landkreis_1_0() {
            return {
                pane: 'pane_landkreis_1',
                opacity: 1,
                color: 'rgba(151,151,151,1.0)',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(114,155,111,0.0)',
                interactive: true,
            }
        }
        map.createPane('pane_landkreis_1');
        map.getPane('pane_landkreis_1').style.zIndex = 401;
        map.getPane('pane_landkreis_1').style['mix-blend-mode'] = 'normal';
        var layer_landkreis_1 = new L.geoJson(json_landkreis_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_landkreis_1',
            layerName: 'layer_landkreis_1',
            pane: 'pane_landkreis_1',
            onEachFeature: pop_landkreis_1,
            style: style_landkreis_1_0,
        });
        bounds_group.addLayer(layer_landkreis_1);
        map.addLayer(layer_landkreis_1);
		
		
function pop_Festivals_kreis_2(feature, layer) {
    layer.on('click', function(e) {
        var routingContainer = document.querySelector('.leaflet-routing-container');
        var istRoutingAktiv = routingContainer && !routingContainer.classList.contains('leaflet-routing-container-hide');
        if (istRoutingAktiv) {
            L.DomEvent.stopPropagation(e); 
            if (typeof control !== 'undefined') {
                var waypoints = control.getPlan().getWaypoints();
                control.spliceWaypoints(waypoints.length - 1, 1, e.latlng);
            }
            layer.closePopup();
        } else {
            layer.openPopup();
        }
    });
    if (feature.properties['Festival_N']) {
        layer.bindTooltip(String(feature.properties['Festival_N']), {
            sticky: true,
            className: 'my-tooltip'
        });
    }

    var fName = feature.properties['Festival_N'] ? feature.properties['Festival_N'].toString().trim() : 'Unbekanntes Festival';
    var zielUrl = festivalLinks[fName]; // Hier nutzt du festivalLinks
    if (!zielUrl || zielUrl === "") {
        zielUrl = "https://www.google.com/search?q=" + encodeURIComponent(fName + " Festival Brandenburg");
    }

    var popupContent = '<div style="text-align: center; font-weight: bold; font-size: 17px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 10px;">' + 
                        '<a href="' + zielUrl + '" target="_blank" rel="noopener noreferrer" style="color: #8e44ad; text-decoration: none;">' + 
                           fName + '<span style="font-size: 18px; margin-left: 8px;">&#10150;</span>' +
                        '</a>' +
                       '</div>' +
                       '<table>\
                        <tr><th scope="row">Kategorie</th><td>' + (feature.properties['Kategorie'] || '') + '</td></tr>\
                        <tr><th scope="row">Genre</th><td>' + (feature.properties['Genre'] || '') + '</td></tr>\
                        <tr style="height: 10px;"> <td colspan="2"></td> </tr>\
                        <tr><th scope="row">Preise ab</th><td>' + (feature.properties['Preise ab'] !== null ? parseFloat(feature.properties['Preise ab']).toFixed(2).replace('.', ',') + ' €' : '') + '</td></tr>\
                        <tr><th scope="row">Datum</th><td>' + (feature.properties['Datum'] || '') + '</td></tr>\
                        <tr><th scope="row">Dauer</th><td>' + (feature.properties['Dauer'] || '') + '</td></tr>\
                        <tr style="height: 10px;"> <td colspan="2"></td> </tr>\
                        <tr><th scope="row">Straße</th><td>' + (feature.properties['Straße'] || '') + '</td></tr>\
                        <tr><th scope="row">PLZ</th><td>' + (feature.properties['PLZ'] || '') + '</td></tr>\
                        <tr><th scope="row">Ort</th><td>' + (feature.properties['Ort'] || '') + '</td></tr>\
                        <tr><th scope="row">Landkreis</th><td>' + (feature.properties['gen'] || '') + '</td></tr>\
                       </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

       map.createPane('pane_festival_2');
map.getPane('pane_festival_2').style.zIndex = 402;
/* meine ICONS einbauen */
function getFestivalIcon(kategorie) {
    var fileName;
    var kat = String(kategorie).toLowerCase().replace(/\s/g, '');
    if (kat.includes('indie') && kat.includes('electro')) {
        fileName = 'Indie-Electro_symbol.png';
    } else if (kat.includes('fantasy') || kat.includes('pop')) {
        fileName = 'Fantasy-Pop_symbol.png';
    } else if (kat.includes('electro')) {
        fileName = 'Electro_symbol.png';
    } else if (kat.includes('metal')) {
        fileName = 'Metal_symbol.png';
    } else if (kat.includes('rock')) {
        fileName = 'Rock_symbol.png';
    } else {
        fileName = 'background.png'; 
    }
    return 'Symbole/' + fileName;
}

// Der Layer-Aufruf
var layer_festival_2 = new L.geoJson(json_festival_2, {
    interactive: true,
    pane: 'pane_festival_2',
    onEachFeature: pop_festival_2,
    pointToLayer: function (feature, latlng) {
        var kat = String(feature.properties['Kategorie']); 
        
        var isMobile = window.innerWidth <= 768;
        var size = isMobile ? 28 : 44; 
        var anchor = size / 2; 
        var festivalIcon = L.icon({
            iconUrl: getFestivalIcon(kat),
            iconSize: [size, size],
            iconAnchor: [anchor, anchor],
            popupAnchor: [0, -anchor] 
        });

        return L.marker(latlng, {
            icon: festivalIcon,
            pane: 'pane_festival_2',
            interactive: true
        });
    }
});
        bounds_group.addLayer(layer_festival_2);
        map.addLayer(layer_festival_2);
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        // Create a variable to store the geoJSON data
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        search.style.backgroundColor="rgba(255,255,255,0.5)" 

        // Create the new button element
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";

        // Insert the button at the beginning of the search control
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        map.addControl(new L.Control.Search({
            layer: layer_festival_2,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'Genre'}));
        if (typeof url === 'undefined') {
            document.getElementsByClassName('search-button')[0].className += ' fa fa-binoculars';
        } else {
            document.getElementsByClassName('search-button')[1].className += ' fa fa-binoculars';
        }
			
        </script>
    </body>
</html>
